<!DOCTYPE html>
<html>
<head>
  <title>Competition Login</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<div class="card">

  <h2>Basic C Programming Competition</h2>

  <div class="tabs">
    <button onclick="showForm('login')">Login</button>
    <button onclick="showForm('signup')">Signup</button>
  </div>


  <!-- LOGIN -->
  <form id="login" class="form">

    <input type="email" placeholder="Email" required>
    <input type="password" placeholder="Password" required>

    <!-- CAPTCHA -->
    <p id="captchaQuestion"></p>
    <input type="number" id="captchaAnswer" placeholder="Solve captcha" required>

    <button type="submit">Login</button>

    <p>
      <a href="#" onclick="resetPassword()">Forgot Password?</a>
    </p>

  </form>



  <!-- SIGNUP -->
  <form id="signup" class="form hidden">

    <input type="text" placeholder="Full Name" required>
    <input type="email" placeholder="Email" required>
    <input type="password" placeholder="Password" required>

    <button>Create Account</button>

  </form>


</div>



<!-- ================= FIREBASE AUTH ================= -->

<script type="module">

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  sendPasswordResetEmail,
  onAuthStateChanged
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";



/* ðŸ”¥ YOUR CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyDFZLqKmwGfJ2Q9HZUDzsLW5MQo7pv1YSY",
  authDomain: "c-competition-portal.firebaseapp.com",
  projectId: "c-competition-portal",
  appId: "1:242421140127:web:8e2dc9023bf8c5ec3530aa"
};


const app = initializeApp(firebaseConfig);
const auth = getAuth(app);



/* ================= CAPTCHA ================= */

let a = Math.floor(Math.random()*10);
let b = Math.floor(Math.random()*10);
let correctAnswer = a + b;

document.getElementById("captchaQuestion").innerText =
`Captcha: ${a} + ${b} = ?`;


/* ================= TAB SWITCH ================= */

window.showForm = function(id){
  document.querySelectorAll(".form").forEach(f => f.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}



/* ================= SIGNUP ================= */

document.getElementById("signup").addEventListener("submit", async (e)=>{
  e.preventDefault();

  const email = e.target[1].value;
  const password = e.target[2].value;

  try{
    await createUserWithEmailAndPassword(auth, email, password);
    alert("Signup successful!");
    showForm("login");
  }
  catch(err){
    alert(err.message);
  }
});



/* ================= LOGIN ================= */

document.getElementById("login").addEventListener("submit", async (e)=>{
  e.preventDefault();

  const email = e.target[0].value;
  const password = e.target[1].value;
  const captcha = document.getElementById("captchaAnswer").value;

  if(captcha != correctAnswer){
    alert("Captcha incorrect âŒ");
    return;
  }

  try{
    await signInWithEmailAndPassword(auth, email, password);
    window.location.href = "dashboard.html";
  }
  catch(err){

    // Custom friendly messages
    if(err.code === "auth/user-not-found"){
      alert("Email not registered âŒ");
    }
    else if(err.code === "auth/wrong-password"){
      alert("Wrong password âŒ");
    }
    else{
      alert(err.message);
    }
  }
});



/* ================= FORGOT PASSWORD ================= */

window.resetPassword = function(){
  const email = prompt("Enter your email:");
  sendPasswordResetEmail(auth, email)
    .then(()=> alert("Reset email sent!"));
}

</script>

</body>
</html>